<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Glaze-like p5.js</title>
  <style>
    body {
      margin: 0;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    canvas {
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
</head>
<body>
<script>
  let W = 800;
  let H = 800;

  function setup() {
    createCanvas(W, H);
    pixelDensity(1);
    colorMode(HSB, 360, 100, 100, 100);
    noLoop();
  }

  function draw() {
    background(0, 0, 15);
    drawGlaze();
  }

  function drawGlaze() {
    // ãƒ©ã‚¤ãƒˆæ–¹å‘ï¼ˆå·¦ä¸Šã‹ã‚‰ï¼‰
    let lx = -0.3;
    let ly = -0.5;
    let lz = 1.0;
    let lenL = Math.sqrt(lx*lx + ly*ly + lz*lz);
    lx /= lenL;
    ly /= lenL;
    lz /= lenL;

    // æç”»
    loadPixels();
    for (let y = 0; y < H; y++) {
      for (let x = 0; x < W; x++) {

        // å£ºã£ã½ã„æ¥•å††ã®ãƒ­ãƒ¼ã‚«ãƒ«åº§æ¨™ã«æ­£è¦åŒ–
        let nx = (x - W * 0.5) / (W * 0.3);    // æ¨ªæ–¹å‘
        let ny = (y - H * 0.55) / (H * 0.45);  // ç¸¦æ–¹å‘

        let r2 = nx*nx + ny*ny;
        if (r2 <= 1.0) { // å½¢ã®å†…å´ã ã‘

          // ä¸­å¿ƒãŒåšã„ã‚¤ãƒ¡ãƒ¼ã‚¸
          let thickness = Math.sqrt(1.0 - r2);

          // é‡‰è–¬ã®"æµã‚Œ"ãƒã‚¤ã‚ºï¼ˆç¸¦æ–¹å‘å¼·ã‚ï¼‰
          let n1 = noise(x * 0.01, y * 0.03);
          let n2 = noise(x * 0.02, y * 0.01 + n1 * 2.0);
          let flow = n1 * 0.6 + n2 * 0.4; // 0ã€œ1

          // ä¸‹å´ã§é‡‰è–¬ãŒæºœã¾ã‚‹æ„Ÿã˜
          let vertical = map(y, H * 0.2, H * 0.9, 0, 1);
          vertical = constrain(vertical, 0, 1);

          // ğŸŸ¦ è‰²è¨­è¨ˆï¼šé’ç£ã£ã½ã„æ„Ÿã˜
          let baseHue  = 190; // ãƒ™ãƒ¼ã‚¹ã®è‰²ç›¸
          let hueRange = 20;  // ãƒã‚¤ã‚ºã«ã‚ˆã‚‹æºã‚‰ã
          let h = baseHue + hueRange * (flow - 0.5);

          let s = 40 + 40 * thickness + 20 * vertical;  // åšã¿ï¼†ä¸‹ã®æ–¹ã§å½©åº¦ã‚¢ãƒƒãƒ—
          let b = 35 + 25 * flow + 30 * thickness;      // ãƒã‚¤ã‚ºï¼†åšã¿ã§æ˜åº¦

          // æ¥•å††ä½“ã®æ³•ç·šã£ã½ã„ã‚‚ã®
          let nx3 = nx;
          let ny3 = ny;
          let nz3 = Math.sqrt(Math.max(0, 1.0 - nx3*nx3 - ny3*ny3));

          let lenN = Math.sqrt(nx3*nx3 + ny3*ny3 + nz3*nz3);
          if (lenN > 0) {
            nx3 /= lenN;
            ny3 /= lenN;
            nz3 /= lenN;
          }

          // æ‹¡æ•£ï¼‹ã‚¹ãƒšã‚­ãƒ¥ãƒ©
          let dot = Math.max(0, nx3*lx + ny3*ly + nz3*lz);
          let diff = dot;
          let spec = Math.pow(dot, 30) * 60.0; // å…‰æ²¢ã®å¼·ã•

          b = b * (0.6 + 0.4 * diff);   // ãƒ©ã‚¤ãƒˆã§å°‘ã—ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ
          b = constrain(b + spec, 0, 100);

          // å¾®å¦™ãªãƒ ãƒ©ï¼ˆãƒã‚¤ã‚¯ãƒ­ãƒã‚¤ã‚ºï¼‰
          let microNoise = noise(x * 0.3, y * 0.3) - 0.5;
          b = constrain(b + microNoise * 8, 0, 100);

          // HSB â†’ RGB ã«ã—ã¦ pixels[] ã«æ›¸ãè¾¼ã¿
          let c = color(h, s, b);
          let idx = (y * W + x) * 4;
          pixels[idx + 0] = red(c);
          pixels[idx + 1] = green(c);
          pixels[idx + 2] = blue(c);
          pixels[idx + 3] = 255;
        }
      }
    }
    updatePixels();
  }

  // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§ãƒ‘ã‚¿ãƒ¼ãƒ³å†ç”Ÿæˆ
  function keyPressed() {
    if (key === ' ') {
      noiseSeed(Math.floor(Math.random() * 100000));
      redraw();
    }
  }
</script>
</body>
</html>
